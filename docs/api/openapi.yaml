openapi: 3.0.0
info:
  title: Citadel Agent API
  description: API for Citadel Agent - Autonomous Secure Workflow Engine
  version: 1.0.0
  contact:
    name: Citadel Agent Support
    email: support@citadel-agent.com

servers:
  - url: http://localhost:5001/api/v1
    description: Development server
  - url: https://api.citadel-agent.com/v1
    description: Production server

paths:
  /auth/login:
    post:
      summary: User login
      description: Login with email and password to get JWT token
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: user@example.com
                password:
                  type: string
                  example: securepassword
              required:
                - email
                - password
      responses:
        '200':
          description: Successful login
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/register:
    post:
      summary: User registration
      description: Register a new user account
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: user@example.com
                password:
                  type: string
                  example: securepassword
                username:
                  type: string
                  example: johndoe
                first_name:
                  type: string
                  example: John
                last_name:
                  type: string
                  example: Doe
              required:
                - email
                - password
                - username
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/github:
    get:
      summary: Initiate GitHub OAuth
      description: Redirects to GitHub for authentication
      tags:
        - Authentication
      responses:
        '302':
          description: Redirect to GitHub OAuth

  /auth/github/callback:
    get:
      summary: Handle GitHub OAuth callback
      description: Handles the callback from GitHub OAuth
      tags:
        - Authentication
      parameters:
        - name: code
          in: query
          required: true
          schema:
            type: string
          description: Authorization code from GitHub
      responses:
        '200':
          description: GitHub authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: GitHub authentication successful
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        example: github_user_id
                      name:
                        type: string
                        example: GitHub User
                      email:
                        type: string
                        example: githubuser@example.com
                      avatar_url:
                        type: string
                        example: https://avatars.githubusercontent.com/u/123456789
                  token:
                    type: string
                    example: github_access_token

  /auth/google:
    get:
      summary: Initiate Google OAuth
      description: Redirects to Google for authentication
      tags:
        - Authentication
      responses:
        '302':
          description: Redirect to Google OAuth

  /auth/google/callback:
    get:
      summary: Handle Google OAuth callback
      description: Handles the callback from Google OAuth
      tags:
        - Authentication
      parameters:
        - name: code
          in: query
          required: true
          schema:
            type: string
          description: Authorization code from Google
      responses:
        '200':
          description: Google authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Google authentication successful
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        example: google_user_id
                      name:
                        type: string
                        example: Google User
                      email:
                        type: string
                        example: googleuser@example.com
                      avatar_url:
                        type: string
                        example: https://lh3.googleusercontent.com/a-/123456789
                  token:
                    type: string
                    example: google_access_token

  /workflows:
    get:
      summary: Get workflows
      description: Get list of workflows for the authenticated user
      tags:
        - Workflows
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of workflows
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Workflow'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Create workflow
      description: Create a new workflow
      tags:
        - Workflows
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowRequest'
      responses:
        '201':
          description: Workflow created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workflow'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /workflows/{id}:
    get:
      summary: Get workflow by ID
      description: Get a specific workflow by ID
      tags:
        - Workflows
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Workflow ID
      responses:
        '200':
          description: Workflow details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workflow'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Workflow not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      summary: Update workflow
      description: Update an existing workflow
      tags:
        - Workflows
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Workflow ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowRequest'
      responses:
        '200':
          description: Workflow updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workflow'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Workflow not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete workflow
      description: Delete a workflow by ID
      tags:
        - Workflows
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Workflow ID
      responses:
        '204':
          description: Workflow deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Workflow not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /workflows/{id}/run:
    post:
      summary: Execute workflow
      description: Execute a workflow
      tags:
        - Workflows
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Workflow ID
      responses:
        '200':
          description: Workflow executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Workflow executed successfully
                  workflow_id:
                    type: string
                    example: workflow-123
                  execution_id:
                    type: string
                    example: execution-456
                  status:
                    type: string
                    example: completed
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Workflow not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /nodes:
    get:
      summary: Get available nodes
      description: Get list of available nodes
      tags:
        - Nodes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of available nodes
          content:
            application/json:
              schema:
                type: object
                properties:
                  nodes:
                    type: array
                    items:
                      $ref: '#/components/schemas/NodeDefinition'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /nodes/types:
    get:
      summary: Get node types
      description: Get list of available node types
      tags:
        - Nodes
      responses:
        '200':
          description: List of node types
          content:
            application/json:
              schema:
                type: object
                properties:
                  node_types:
                    type: array
                    items:
                      type: string
                      example: http_request

  /ai-agents:
    post:
      summary: Create AI agent
      description: Create a new AI agent
      tags:
        - AI Agents
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: Customer Support Agent
                description:
                  type: string
                  example: AI agent to handle customer support queries
                config:
                  type: object
                  example: {}
                tools:
                  type: array
                  items:
                    type: string
                  example: []
      responses:
        '201':
          description: AI agent created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIAgent'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    get:
      summary: Get AI agents
      description: Get list of AI agents
      tags:
        - AI Agents
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of AI agents
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AIAgent'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ai-agents/{id}:
    get:
      summary: Get AI agent by ID
      description: Get a specific AI agent by ID
      tags:
        - AI Agents
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: AI Agent ID
      responses:
        '200':
          description: AI agent details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIAgent'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: AI agent not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      summary: Update AI agent
      description: Update an existing AI agent
      tags:
        - AI Agents
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: AI Agent ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AIAgentRequest'
      responses:
        '200':
          description: AI agent updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIAgent'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: AI agent not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete AI agent
      description: Delete an AI agent by ID
      tags:
        - AI Agents
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: AI Agent ID
      responses:
        '204':
          description: AI agent deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: AI agent not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ai-agents/{id}/execute:
    post:
      summary: Execute AI agent
      description: Execute an AI agent
      tags:
        - AI Agents
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: AI Agent ID
      responses:
        '200':
          description: AI agent executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AI agent executed successfully
                  agent_id:
                    type: string
                    example: agent-123
                  execution_id:
                    type: string
                    example: execution-456
                  result:
                    type: object
                    example: {}
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: AI agent not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ai-agents/{id}/tools:
    post:
      summary: Add tool to AI agent
      description: Add a tool to an AI agent
      tags:
        - AI Agents
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: AI Agent ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tool_id:
                  type: string
                  example: tool-123
                config:
                  type: object
                  example: {}
              required:
                - tool_id
      responses:
        '200':
          description: Tool added to AI agent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Tool added to AI agent successfully
                  agent_id:
                    type: string
                    example: agent-123
                  tool_id:
                    type: string
                    example: tool-123
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: AI agent not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /runtime/execute:
    post:
      summary: Execute code in runtime
      description: Execute code in a specific runtime environment
      tags:
        - Runtime
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                runtime_type:
                  type: string
                  enum: [go, python, javascript, java, ruby, php, rust, csharp]
                  example: python
                code:
                  type: string
                  example: print("Hello, World!")
                input:
                  type: object
                  example: {}
                timeout:
                  type: integer
                  example: 30
              required:
                - runtime_type
                - code
      responses:
        '200':
          description: Code executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    $ref: '#/components/schemas/CodeExecutionResult'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/me:
    get:
      summary: Get current user
      description: Get the authenticated user's profile
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      summary: Update current user
      description: Update the authenticated user's profile
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: johndoe
                first_name:
                  type: string
                  example: John
                last_name:
                  type: string
                  example: Doe
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /health:
    get:
      summary: Health check
      description: Check the health status of the API
      tags:
        - Health
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    example: "2023-01-01T10:00:00Z"
                  version:
                    type: string
                    example: "1.0.0"

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          example: user-123
        email:
          type: string
          format: email
          example: user@example.com
        username:
          type: string
          example: johndoe
        first_name:
          type: string
          example: John
        last_name:
          type: string
          example: Doe
        created_at:
          type: integer
          format: int64
          example: 1672531200
        updated_at:
          type: integer
          format: int64
          example: 1672531200

    Workflow:
      type: object
      properties:
        id:
          type: string
          example: workflow-123
        name:
          type: string
          example: Data Processing Workflow
        description:
          type: string
          example: A workflow to process and analyze data
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/Node'
        status:
          type: string
          example: active
        created_at:
          type: integer
          format: int64
          example: 1672531200
        updated_at:
          type: integer
          format: int64
          example: 1672531200

    WorkflowRequest:
      type: object
      properties:
        name:
          type: string
          example: Data Processing Workflow
        description:
          type: string
          example: A workflow to process and analyze data
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/Node'

    Node:
      type: object
      properties:
        id:
          type: string
          example: node-123
        type:
          type: string
          example: http_request
        config:
          type: object
          example: {}
        input:
          type: object
          example: {}
        output:
          type: object
          example: {}
        status:
          type: string
          example: pending
        children:
          type: array
          items:
            $ref: '#/components/schemas/Node'

    NodeDefinition:
      type: object
      properties:
        type:
          type: string
          example: http_request
        name:
          type: string
          example: HTTP Request
        description:
          type: string
          example: Makes an HTTP request to a specified URL
        inputs:
          type: object
          example: {}
        outputs:
          type: object
          example: {}
        config:
          type: object
          example: {}
        icon:
          type: string
          example: "üåê"
        category:
          type: string
          example: Communication

    AIAgent:
      type: object
      properties:
        id:
          type: string
          example: agent-123
        name:
          type: string
          example: Customer Support Agent
        description:
          type: string
          example: AI agent to handle customer support queries
        config:
          type: object
          example: {}
        tools:
          type: array
          items:
            type: string
          example: []
        status:
          type: string
          example: active
        created_at:
          type: integer
          format: int64
          example: 1672531200
        updated_at:
          type: integer
          format: int64
          example: 1672531200

    AIAgentRequest:
      type: object
      properties:
        name:
          type: string
          example: Customer Support Agent
        description:
          type: string
          example: AI agent to handle customer support queries
        config:
          type: object
          example: {}
        tools:
          type: array
          items:
            type: string
          example: []

    CodeExecutionResult:
      type: object
      properties:
        output:
          type: string
          example: Code executed successfully
        error:
          type: string
          example: ""
        success:
          type: boolean
          example: true
        execution_time:
          type: integer
          example: 100
        resources:
          type: object
          example: {}

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: Error message

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []

tags:
  - name: Authentication
    description: Authentication endpoints (login, register, OAuth)
  - name: Workflows
    description: Workflow management endpoints
  - name: Nodes
    description: Node management endpoints
  - name: AI Agents
    description: AI agent management endpoints
  - name: Runtime
    description: Code execution in different runtime environments
  - name: Users
    description: User management endpoints
  - name: Health
    description: Health check endpoint